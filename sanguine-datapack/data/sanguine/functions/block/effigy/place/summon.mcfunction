## Preserve State
#data remove storage sanguine:storage root.temp
#execute if entity @s[nbt={SelectedItem:{tag:{sanguine:{id:"effigy"}}}}] run data modify storage sanguine:storage root.temp.effigy_state set from entity @s SelectedItem.tag.sanguine.effigy_state
#execute unless entity @s[nbt={SelectedItem:{tag:{sanguine:{id:"effigy"}}}}] run data modify storage sanguine:storage root.temp.effigy_state set from entity @s Inventory[{Slot:-106b}].tag.sanguine.effigy_state

## Spawned by Player
execute if entity @s[y_rotation=135..-135] run summon wandering_trader ~0.5 -500 ~0.5 {Team:"smithed.prevent_aggression",Rotation:[0.0f,0.0f],Tags:["sanguine.block","sanguine.entity","smithed.block","smithed.entity","sanguine.effigy","sanguine.trader_entity","sanguine.effigy.start","sanguine.block.start","sanguine.trader_entity.static","sanguine.entity.prevent_glowing"],CustomName:'{"translate":"block.sanguine.effigy"}',AbsorptionAmount:10e100f,Health:0.01f,Silent:1b,NoAI:1b,DeathTime:19s,Offers:{Recipes:[]},ActiveEffects:[{Id:14b,Duration:100000,Amplifier:0b,ShowParticles:0b}],ArmorDropChances:[-10000.0f,-10000.0f,-10000.0f,-10000.0f],HandDropChances:[-10000.0f,-10000.0f],ArmorItems:[{},{},{},{Count:1b,id:"minecraft:structure_block",tag:{sanguine:{effigy_break_state:0,custom_model_data:{idle:8361049}},CustomModelData:8361000}}],HandItems:[{id:"minecraft:potion",Count:1b,tag:{CustomPotionColor:16777215,CustomModelData:8361049}}],DeathLootTable:"sanguine:blocks/effigy"}
execute if entity @s[y_rotation=-135..-45] run summon wandering_trader ~0.5 -500 ~0.5 {Team:"smithed.prevent_aggression",Rotation:[90.0f,0.0f],Tags:["sanguine.block","sanguine.entity","smithed.block","smithed.entity","sanguine.effigy","sanguine.trader_entity","sanguine.effigy.start","sanguine.block.start","sanguine.trader_entity.static","sanguine.entity.prevent_glowing"],CustomName:'{"translate":"block.sanguine.effigy"}',AbsorptionAmount:10e100f,Health:0.01f,Silent:1b,NoAI:1b,DeathTime:19s,Offers:{Recipes:[]},ActiveEffects:[{Id:14b,Duration:100000,Amplifier:0b,ShowParticles:0b}],ArmorDropChances:[-10000.0f,-10000.0f,-10000.0f,-10000.0f],HandDropChances:[-10000.0f,-10000.0f],ArmorItems:[{},{},{},{Count:1b,id:"minecraft:structure_block",tag:{sanguine:{effigy_break_state:0,custom_model_data:{idle:8361049}},CustomModelData:8361000}}],HandItems:[{id:"minecraft:potion",Count:1b,tag:{CustomPotionColor:16777215,CustomModelData:8361049}}],DeathLootTable:"sanguine:blocks/effigy"}
execute if entity @s[y_rotation=-45..45] run summon wandering_trader ~0.5 -500 ~0.5 {Team:"smithed.prevent_aggression",Rotation:[180.0f,0.0f],Tags:["sanguine.block","sanguine.entity","smithed.block","smithed.entity","sanguine.effigy","sanguine.trader_entity","sanguine.effigy.start","sanguine.block.start","sanguine.trader_entity.static","sanguine.entity.prevent_glowing"],CustomName:'{"translate":"block.sanguine.effigy"}',AbsorptionAmount:10e100f,Health:0.01f,Silent:1b,NoAI:1b,DeathTime:19s,Offers:{Recipes:[]},ActiveEffects:[{Id:14b,Duration:100000,Amplifier:0b,ShowParticles:0b}],ArmorDropChances:[-10000.0f,-10000.0f,-10000.0f,-10000.0f],HandDropChances:[-10000.0f,-10000.0f],ArmorItems:[{},{},{},{Count:1b,id:"minecraft:structure_block",tag:{sanguine:{effigy_break_state:0,custom_model_data:{idle:8361049}},CustomModelData:8361000}}],HandItems:[{id:"minecraft:potion",Count:1b,tag:{CustomPotionColor:16777215,CustomModelData:8361049}}],DeathLootTable:"sanguine:blocks/effigy"}
execute if entity @s[y_rotation=45..135] run summon wandering_trader ~0.5 -500 ~0.5 {Team:"smithed.prevent_aggression",Rotation:[270.0f,0.0f],Tags:["sanguine.block","sanguine.entity","smithed.block","smithed.entity","sanguine.effigy","sanguine.trader_entity","sanguine.effigy.start","sanguine.block.start","sanguine.trader_entity.static","sanguine.entity.prevent_glowing"],CustomName:'{"translate":"block.sanguine.effigy"}',AbsorptionAmount:10e100f,Health:0.01f,Silent:1b,NoAI:1b,DeathTime:19s,Offers:{Recipes:[]},ActiveEffects:[{Id:14b,Duration:100000,Amplifier:0b,ShowParticles:0b}],ArmorDropChances:[-10000.0f,-10000.0f,-10000.0f,-10000.0f],HandDropChances:[-10000.0f,-10000.0f],ArmorItems:[{},{},{},{Count:1b,id:"minecraft:structure_block",tag:{sanguine:{effigy_break_state:0,custom_model_data:{idle:8361049}},CustomModelData:8361000}}],HandItems:[{id:"minecraft:potion",Count:1b,tag:{CustomPotionColor:16777215,CustomModelData:8361049}}],DeathLootTable:"sanguine:blocks/effigy"}
execute if entity @s run summon item_frame ~ ~1 ~ {Item:{id:"minecraft:structure_block",Count:1b,tag:{CustomModelData:8361000}},Facing:1b,Invulnerable:1b,Tags:["smithed.entity","sanguine.effigy.temp","sanguine.block.temp"],Silent:1b,Fixed:1b,Invisible:1b}

## Spawned from Command Block
execute unless entity @s run setblock ~ ~ ~ air
execute unless entity @s run summon wandering_trader ~ ~-0.5 ~ {Team:"smithed.prevent_aggression",Tags:["sanguine.block","sanguine.entity","smithed.block","smithed.entity","sanguine.effigy","sanguine.trader_entity","sanguine.effigy.start","sanguine.block.start","sanguine.effigy.naturally_spawned","sanguine.trader_entity.static","sanguine.entity.prevent_glowing"],CustomName:'{"translate":"block.sanguine.effigy"}',AbsorptionAmount:10e100f,Health:0.01f,Silent:1b,NoAI:1b,DeathTime:19s,Offers:{Recipes:[]},ActiveEffects:[{Id:14b,Duration:100000,Amplifier:0b,ShowParticles:0b}],ArmorDropChances:[-10000.0f,-10000.0f,-10000.0f,-10000.0f],HandDropChances:[-10000.0f,-10000.0f],ArmorItems:[{},{},{},{Count:1b,id:"minecraft:structure_block",tag:{sanguine:{effigy_break_state:0,custom_model_data:{idle:8361049}},CustomModelData:8361000}}],HandItems:[{id:"minecraft:potion",Count:1b,tag:{CustomPotionColor:16777215,CustomModelData:8361049}}],DeathLootTable:"sanguine:blocks/effigy"}

## Clear Items
item replace entity @s[gamemode=!creative,nbt={Inventory:[{Slot:-106b,tag:{sanguine:{id:"effigy"}}}]},nbt=!{SelectedItem:{tag:{sanguine:{id:"effigy"}}}}] weapon.offhand with air
item replace entity @s[gamemode=!creative,nbt={SelectedItem:{tag:{sanguine:{id:"effigy"}}}}] weapon.mainhand with air
playsound minecraft:block.fungus.place block @a
